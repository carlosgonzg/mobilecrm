<div class="row">
	<div class="col-xs-12">
		<h1 class="pull-left">
			<i class="fa fa-lg fa-calculator"></i> <span> Service Order</span>
		</h1>
		<div class="btn-group pull-right" style="margin-top: 20px;" role="group" aria-label="...">
			<button type="submit" form="userForm" class="btn btn-primary" ng-click="save()" ng-if="userData.role._id == 1">
				<i class="fa fa-save"></i>&nbsp;<span>Save</span>
			</button>
			<back-button></back-button>
		</div>
		<hr />
	</div>
</div>
<form class="form" id="userForm" name="userForm">
	<div class="row">
		<div class="col-xs-12">
			<div class="col-xs-4">
				<div class="col-xs-12 pull-left">
					<div class="form-group">
						<label for="Client">Client</label>
						<entitypicker ng-model="orderService.client" ws-class="wsClass" ws-fields="wsFields" disable="userData.role._id != 1"></entitypicker>
					</div>
				</div>
				<div class="col-xs-12 pull-left" ng-show="orderService.client._id">
					<div class="panel panel-default">
						<div class="panel-heading">{{orderService.client.entity.fullName}}</div>
						<div class="panel-body">
							<p class="col-xs-12 text-left" ng-repeat="address in orderService.client.addresses track by $index">
								<i class="fa fa-map"></i>&nbsp;{{ address.address1 }},&nbsp;{{ address.city.description }},&nbsp;{{ address.state.description }},&nbsp;{{ address.country.description }}
							</p>
							<p class="col-xs-12 text-left" ng-repeat="phone in orderService.client.phones track by $index">
								<i class="fa fa-phone"></i>&nbsp;{{ phone.number }}
							</p>
						</div>
					</div>
				</div>
			</div>
			<div class="col-xs-4">
			</div>
			<div class="col-xs-4">
				<div class="col-xs-12 pull-right">
					<div class="form-group">
						<label for="date">Invoice #</label>
						<input type="text" class="form-control" ng-model="orderService.invoiceNumber" disabled>
					</div>
				</div>
				<div class="col-xs-12 pull-right">
					<div class="form-group">
						<label for="pono">Status</label>
						<select class="form-control" ng-model="orderService.status" ng-options="status as status.description for status in listStatus track by status._id" ng-disabled="userData.role._id != 1"></select>
					</div>
				</div>
				<div class="col-xs-12 pull-right">
					<div class="form-group">
						<label for="date">Date</label>
						<sc-datepicker ng-model="orderService.date" ng-disabled="userData.role._id != 1"></sc-datepicker>
					</div>
				</div>
				<div class="col-xs-12 pull-right">
					<div class="form-group">
						<label for="pono">Address</label>
						<select class="form-control" ng-model="orderService.siteAddress" ng-options="address as address.address1 for address in orderService.client.addresses track by address.branch" ng-disabled="userData.role._id != 1"></select>
					</div>
				</div>
				<div class="col-xs-12 pull-right">
					<div class="form-group">
						<label for="pono">Phone</label>
						<select class="form-control" ng-model="orderService.phone" ng-options="phone as phone.number for phone in orderService.client.phones track by phone.number" ng-disabled="userData.role._id != 1"></select>
					</div>
				</div>
				<div class="col-xs-12 pull-right">
					<div class="form-group">
						<label for="pono">PO #</label>
						<input type="text" class="form-control" ng-model="orderService.pono" ng-disabled="userData.role._id != 1">
					</div>
				</div>
				<div class="col-xs-12 pull-right">
					<div class="form-group">
						<label for="pono">ISO #</label>
						<input type="text" class="form-control" ng-model="orderService.isono" ng-disabled="userData.role._id != 1">
					</div>
				</div>
				<div class="col-xs-12 pull-right">
					<div class="form-group">
						<label for="date">Unit #</label>
						<input type="text" class="form-control" ng-model="orderService.unitno" ng-disabled="userData.role._id != 1">
					</div>
				</div>
				<div class="col-xs-12 pull-right">
					<div class="form-group">
						<label for="date">SOR</label>
						<input type="text" class="form-control" ng-model="orderService.sor" ng-disabled="userData.role._id != 1">
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-xs-12">
			<table class="table table-striped table-hover" width="960" style="margin: 0 auto">
				<thead>
					<tr>
						<th width="290">
							Code
						</th>
						<th width="100">
							Quantity
						</th>
						<th width="150">
							Price
						</th>
						<th width="150">
							Total
						</th>
						<th width="70">
							<button type="button" class="btn btn-sm btn-primary" ng-click="addItem()" ng-if="userData.role._id == 1">
								<i class="fa fa-plus"></i>
							</button>
						</th>
					</tr>
				</thead>
				<tbody>
					<tr ng-repeat="item in orderService.items track by $index">
						<td>
							<ui-select ng-model="newItem" theme="bootstrap" on-select="setItem(newItem, $index)"  ng-disabled="userData.role._id != 1">
				            	<ui-select-match placeholder="Select the item you want on the list...">
            						{{$select.selected.code}}&nbsp;-&nbsp;{{$select.selected.description}}
				            	</ui-select-match>
				            	<ui-select-choices repeat="i in items | filter: $select.search track by i._id">
			              			<div ng-bind-html="i.description | highlight: $select.search"></div>
				              		<small ng-bind-html="i.code | highlight: $select.search"></small>
				            	</ui-select-choices>
				          	</ui-select>
						</td>
						<td>
							<input type="number" class="form-control" ng-model="item.quantity"  ng-disabled="userData.role._id != 1">
						</td>
						<td>
							<input type="number" class="form-control" ng-model="item.price"  ng-disabled="userData.role._id != 1">
						</td>
						<td>
							{{item.getTotalPrice() | currency }}
						</td>
						<td>
							<button type="button" class="btn btn-sm btn-danger" ng-click="removeItem()" ng-if="userData.role._id == 1">
								<i class="fa fa-times"></i>
							</button>
						</td>
					</tr>
				</tbody>
				<tfoot>
					<tr>
						<th colspan="3">
							<span class="pull-right">
								Total
							</span>
						</th>
						<th colspan="2">
							<span class="pull-left">
								{{orderService.getTotal() | currency}}
							</span>
						</th>
					</tr>
				</tfoot>
			</table>
		</div>
	</div>
	<div class="row">
		<div class="col-xs-12">
			<div class="col-xs-4 pull-left">
					<div class="form-group">
						<label for="comment">Issue / Comment</label>
						<textarea id="comment" ng-model="orderService.comment" class="form-control">
							
						</textarea> 
					</div>
				</div>
		</div>
	</div>
</form>
