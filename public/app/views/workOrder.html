<form class="form" id="workOrderForm" name="workOrderForm" novalidate>
	<div class="row">
		<div class="col-xs-12">
			<h1 class="pull-left">
				<i class="fa fa-lg fa-calculator"></i> <span> Work Order</span>
			</h1>
			<div class="btn-group pull-right" style="margin-top: 20px;" role="group" aria-label="...">
				<button type="submit" class="btn btn-primary update" ng-click="save()" ng-if="userData.role._id == 1" ng-disabled="waiting">
					<i class="fa fa-save"></i>&nbsp;<span>Save</span>
				</button>
				<button type="submit" form="userForm" class="btn btn-primary update" ng-click="save(true)" ng-disabled="waiting">
					<i class="fa fa-save"></i>&nbsp;<span>Save & Send to MobileOne</span>
				</button>
				<button type="button" class="btn btn-danger" ng-click="delete()" ng-if="workOrder._id && userData.role._id == 1">
					<i class="fa fa-trash"></i>&nbsp;<span>Delete</span>
				</button>
				<button type="button" class="btn btn-default" ng-click="export()" ng-if="workOrder._id">
					<i class="fa fa-download"></i>&nbsp;<span>Print for Tech</span>
				</button>
				<button type="button" class="btn btn-default" ng-click="export(true)" ng-if="workOrder._id">
					<i class="fa fa-download"></i>&nbsp;<span>Print for Corporate</span>
				</button>
				<button type="button" class="btn btn-default" ng-click="send()" ng-if="workOrder._id">
					<i class="fa fa-paper-plane"></i>&nbsp;<span>Send</span>
				</button>
				<back-button></back-button>
			</div>
			<hr />
		</div>
	</div>
	<div class="row">
		<div class="col-xs-12">
			<div class="col-sm-4">
				<div class="col-xs-12 pull-left">
					<div class="form-group">
						<label for="Client">Client</label>
						<entitypicker ng-model="workOrder.client" ng-change="clientChanged(workOrder.client)" ws-class="wsClass" ws-fields="wsFields" disable="userData.role._id != 1" ws-filter="wsFilter"></entitypicker>
					</div>
				</div>
				<div class="col-xs-12 pull-left">
					<div class="panel panel-default" ng-show="workOrder.client._id">
						<div class="panel-heading">{{workOrder.client.entity.fullName}}&nbsp;-&nbsp;{{workOrder.client.company.entity.name}}</div>
						<div class="panel-body">
							<p class="col-xs-12 text-left">
								<b>{{workOrder.client.branch.name}}</b>
								<br/>
								<p class="col-xs-12 text-left" ng-repeat="address in workOrder.client.branch.addresses track by $index">
									<i class="fa fa-map"></i>&nbsp;{{ address.address1 }},&nbsp;{{ address.city.description }},&nbsp;{{ address.state.description }},&nbsp;{{ address.country.description }}
								</p>
							</p>
							<p class="col-xs-12 text-left" ng-repeat="phone in workOrder.client.branch.phones track by $index">
								<i class="fa fa-phone"></i>&nbsp;{{ phone.number }}
							</p>
						</div>
					</div>
				</div>
			</div>
			<div class="col-sm-8">
				<div class="col-sm-6">
					<div class="col-xs-12 pull-right">
						<div class="form-group">
							<label for="sor">Work order #</label>
							<input type="text" name="sor" class="form-control" ng-model="workOrder.wor" ng-class="isChanged('wor')" ng-change="changed('wor');fillComment()" ng-disabled="isDisabled()" validator="required">
						</div>
					</div>
				</div>
				<div class="col-sm-6">
					<div class="col-xs-12 pull-right">
						<div class="form-group">
							<label for="invoiceNumber">Invoice #</label>
							<input type="text" name="invoiceNumber" class="form-control" ng-model="workOrder.invoiceNumber" ng-class="isChanged('invoiceNumber')" ng-change="changed('invoiceNumber')" ng-disabled="isDisabled() || userData.role._id != 1">
						</div>
					</div>
				</div>
				<div class="col-sm-6">
					<div class="col-xs-12 pull-right">
						<div class="form-group">
							<label for="status">Status</label>
							<select class="form-control" name="status" ng-model="workOrder.status" ng-class="isChanged('status')" ng-change="changed('status')" ng-options="status as status.description for status in listStatus track by status._id" ng-disabled="isDisabled() || userData.role._id != 1" validator="required"></select>
						</div>
					</div>
				</div>
				<div class="col-sm-6">
					<div class="col-xs-12 pull-right">
						<div class="form-group">
							<label for="date">Date</label>
							<sc-datepicker ng-model="workOrder.date" ng-class="isChanged('date')" ng-change="changed('date')" ng-disabled="isDisabled()"></sc-datepicker>
						</div>
					</div>
				</div>
				<div class="col-sm-6">
					<div class="col-xs-12 pull-right">
						<div class="form-group">
							<label for="date">Unit #</label>
							<input type="text" class="form-control" ng-model="workOrder.unitno" ng-class="isChanged('unitno')" ng-change="changed('unitno')" ng-disabled="isDisabled()">
						</div>
					</div>
				</div>
				<div class="col-sm-6">
					<div class="col-xs-12 pull-right">
						<div class="form-group">
							<label for="originalShipDate">Completed Date</label>
							<sc-datepicker ng-model="workOrder.originalShipDate" ng-class="isChanged('originalShipDate')" ng-change="changed('originalShipDate')" ng-disabled="userData.role._id != 1"></sc-datepicker>
						</div>
					</div>
				</div>
				<div class="col-sm-6">
					<div class="col-xs-12 pull-right">
						<div class="form-group">
							<label for="date">Unit Size</label>
							<input type="text" class="form-control" ng-model="workOrder.unitSize" ng-class="isChanged('unitSize')" ng-change="changed('unitSize')" ng-disabled="isDisabled()">
						</div>
					</div>
				</div>
				<div class="col-sm-6">
					<div class="col-xs-12 pull-right">
						<div class="form-group">
							<label for="pono">Contract #</label>
							<input type="text" class="form-control" ng-model="workOrder.isono" ng-class="isChanged('isono')" ng-change="changed('isono')" ng-disabled="isDisabled()">
						</div>
					</div>
				</div>
				<div class="col-sm-6">
					<div class="col-xs-12 pull-right">
						<div class="form-group">
							<label for="pono">PO #</label>
							<input type="text" name="pono" class="form-control" ng-model="workOrder.pono" ng-class="isChanged('pono')" ng-change="changed('pono')" ng-disabled="isDisabled()">
						</div>
					</div>
					<div class="col-xs-12 pull-right">
						<div class="checkbox">
						    <label>
						      <input type="checkbox" ng-model="workOrder.clientResponsibleCharges" ng-class="isChanged('clientResponsibleCharges')" ng-change="changed('clientResponsibleCharges')" id="clientResponsibleCharges" ng-disabled="isDisabled()"> Customer responsible for charges
							</label>
					  	</div>
					</div>
				</div>
				<div class="col-sm-6">
					<div class="col-xs-12 pull-right">
						<div class="checkbox">
						    <label>
						      <input type="checkbox" ng-model="workOrder.partsFromTheYard" ng-class="isChanged('partsFromTheYard')" ng-change="changed('partsFromTheYard')" id="partsFromTheYard" ng-disabled="isDisabled()"> Parts from the yard
							</label>
					  	</div>
					</div>
				</div>
				<div class="col-sm-6">
					<div class="col-xs-12 pull-right" ng-if="workOrder.partsFromTheYard">
						<div class="form-group">
							<label for="yardComment">Parts from the Yard</label>
							<textarea id="yardComment" ng-model="workOrder.yardComment" class="form-control">
							</textarea> 
						</div>
					</div>
				</div>
			<!-- 	<div class="col-sm-6">
					<div class="col-xs-12 pull-right">
						<div class="checkbox">
						    <label>
						      <input type="checkbox" ng-model="workOrder.clientResponsibleCharges" ng-class="isChanged('clientResponsibleCharges')" ng-change="changed('clientResponsibleCharges')" id="clientResponsibleCharges" ng-disabled="isDisabled()"> Customer responsible for charges
							</label>
					  	</div>
					</div>
				</div> -->
				<!--
				<div class="col-xs-6">
					<div class="col-xs-12 pull-right">
						<div class="form-group">
							<label for="distanceFrom">Service Miles (Miles)</label>
							<input type="text" name="distanceFrom" class="form-control" ng-model="workOrder.siteAddress.distanceFrom" validator="required">
						</div>
					</div>
				</div>-->
				<div class="col-xs-12">
					<div class="btn btn-default" ngf-select="uploadFiles($files)" ngf-max-size="5MB" ngf-accept="'image/*'" multiple="multiple">Upload Photo(s) (5MB Max)</div>
				</div>
				<div class="col-xs-12">
					<label>Photos</label>
				</div>
				<div class="col-sm-3" ng-repeat="photo in workOrder.photos track by $index">
					<img class="img-rounded" style="width:120px" ng-src="{{photo.url}}"  ng-click="showPicture($index)"/>
					<button type="button" ng-click="removePhoto($index)" class="btn btn-sm btn-danger">
						<i class="fa fa-times"></i>
					</button>
				</div>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-xs-12">
			<table class="table table-striped table-hover" width="100%" style="margin: 0 auto">
				<thead>
					<tr>
						<th width="15%">
							Code
						</th>
						<th width="30%" colspan="2">
							Group Code / Description
						</th>
						<th width="10%">
							Quantity
						</th>
						<th width="10%">
							Price
						</th>
						<th width="10%">
							Total
						</th>
						<th width="15%">
							Part
						</th>
						<th width="10%">
						</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td colspan="5">
							<entitypicker ng-model="params.item" ws-class="wsClassItem" ws-fields="wsFieldsItem" ws-filter="wsFilterItem" disable="!workOrder.client._id" ws-label="'description'" order-by="'code'"></entitypicker>
						</td>
						<td>
							<button type="button" class="btn btn-sm btn-primary update" ng-click="addItem(params.item)" ng-disabled="!params.item._id">
								<i class="fa fa-plus"></i>
							</button>
						</td>
						<td>
							<span><b>Add from Collection</b></span>
						</td>
						<td>
							<button type="button" class="btn btn-sm btn-primary update" ng-click="addItemCollection()" ng-disabled="!workOrder.client._id">
								<i class="fa fa-list"></i>
							</button>
						</td>
					</tr>
					<tr ng-repeat="item in workOrder.items track by $index">
						<td>
							<input type="text" class="form-control" ng-model="item.code"  ng-disabled="isDisabled()">
						<td ng-if="item.itemCollection._id" width="15%">
							{{item.itemCollection.description}}
						</td>
						<td colspan="{{ item.itemCollection._id ? '1' : '2' }}" width="15%">
							<input type="text" name="description{{$index}}" class="form-control" ng-model="item.description"  ng-disabled="isDisabled()" validator="required">
						</td>
						<td>
							<input type="number" name="quantity{{$index}}" class="form-control" ng-model="item.quantity"  ng-disabled="isDisabled()" validator="required" step="0.01">
						</td>
						<td>
							<input type="number" name="price{{$index}}" class="form-control" ng-model="item.price"  ng-disabled="isDisabled()" step="0.01">
						</td>
						<td>
							{{item.getTotalPrice() | currency }}
						</td>
						<td>
							<input type="text" name="part{{$index}}" class="form-control" ng-model="item.part"  ng-disabled="isDisabled()">
						</td>
						<td>
							<button type="button" class="btn btn-sm btn-danger update" ng-click="removeItem($index)">
								<i class="fa fa-times"></i>
							</button>
						</td>
					</tr>
				</tbody>
				<tfoot>
					<tr>
						<th colspan="5">
							<span class="pull-right">
								Total
							</span>
						</th>
						<th colspan="4">
							<span class="pull-left">
								{{workOrder.getTotal() | currency}}
							</span>
						</th>
					</tr>
				</tfoot>
			</table>
		</div>
	</div>
	<div class="row">
		<div class="col-xs-12">
			<div class="col-sm-4 pull-left">
				<div class="form-group">
					<label for="comment">Issue</label>
					<textarea id="comment" ng-model="workOrder.issue" class="form-control">
					</textarea> 
				</div>
				<div class="form-group">
					<label for="comment">Comment</label>
					<textarea id="comment" ng-model="workOrder.comment" class="form-control">
					</textarea> 
				</div>
			</div>
		</div>
	</div>
</form>